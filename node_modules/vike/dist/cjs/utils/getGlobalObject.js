"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.assertIsSingleModuleInstance = exports.getGlobalObject = void 0;
const assert_js_1 = require("./assert.js");
const projectInfo_js_1 = require("./projectInfo.js");
const projectKey = `_${projectInfo_js_1.projectInfo.projectName.toLowerCase()}`;
/** Share information across module instances. */
function getGlobalObject(
// We use the filename (or file path) as key. There should be only one getGlobalObject() usage per file. Thus the key should be unique, assuming the filename (or file path) is unique.
key, defaultValue) {
    const globalObjects = getGlobalObjects();
    const globalObject = (globalObjects[key] = globalObjects[key] || defaultValue);
    return globalObject;
}
exports.getGlobalObject = getGlobalObject;
/** Assert that the module is instantiated only once. */
function assertIsSingleModuleInstance(
// We use the filename (or file path) as key.
key) {
    const globalObjects = getGlobalObjects();
    (0, assert_js_1.assert)(!(key in globalObjects));
}
exports.assertIsSingleModuleInstance = assertIsSingleModuleInstance;
function getGlobalObjects() {
    // @ts-ignore
    const globalObjects = (globalThis[projectKey] = globalThis[projectKey] || {});
    return globalObjects;
}
